<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Ricoh Theta V API Testing</title>
    <meta name="description" content="360 Video with A-Frame">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/js/md5_backup.js"></script>
    <script type="text/javascript" src="/assets/js/digestAuthRequest.js"></script>
    <script>
        const THETA_IP_BOS = "192.168.1.27";
        const THETA_IP_ROC = "192.168.50.227";
        const CORS_ANYWHERE = "http://0.0.0.0:8080";
        const THETA_USER = "THETAYL00164391";
        const THETA_PASS = "00164391";

        // Disables the sleep and auto-power off on the Theta
        // `sleepDelay = 65535` disables auto sleep
        // `offDelay = 65535` disables auto off after standby (or 0?)
        function setThetaNeverSleep() {
            console.log("Disabling the Theta's sleep and autopower off");
            var endpoint = "/osc/commands/execute";
            var url = CORS_ANYWHERE + "/" + THETA_IP_BOS + endpoint;
            var getRequest = new digestAuthRequest('POST', url, THETA_USER, 
                THETA_PASS);
            var postData = { 
                "name": "camera.setOptions",
                "parameters": {
                    "options": {
                        "sleepDelay": 65535,
                        "offDelay": 65535
                    }
                }
            };

            // make the request
            getRequest.request(function(data) {
                console.log(data);
            },function(errorCode) {
                console.log("Failure: " + errorCode);
            }, postData);

        }

        // Gets the ricoh camera's info
        function getRicohInfo() {
            console.log("Getting the ricoh info");
            var endpoint = "/osc/info";
            var url = CORS_ANYWHERE + "/" + THETA_IP_BOS + endpoint;
            var getRequest = new digestAuthRequest('GET', url, THETA_USER, 
                THETA_PASS);
            
            // make the request
            getRequest.request(function(data) {
                console.log(data);
            },function(errorCode) {
                console.log("Failure: " + errorCode);
            });
        }

        // Gets the ricoh camera's info
        function getRicohState() {
            console.log("Getting the ricoh state");
            var endpoint = "/osc/state";
            var url = CORS_ANYWHERE + "/" + THETA_IP_BOS + endpoint;
            var getRequest = new digestAuthRequest('POST', url, THETA_USER, 
                THETA_PASS);
            var postData = null;

            // make the request
            getRequest.request(function(data) {
                console.log(data);
            },function(errorCode) {
                console.log("Failure: " + errorCode);
            }, postData);
        }

        // Gets a live preview from the camera
        function getRicohLivePreview() {
            console.log("Getting the ricoh's live preview");
            var endpoint = "/osc/commands/execute";
            var url = CORS_ANYWHERE + "/" + THETA_IP_BOS + endpoint;
            var getRequest = new digestAuthRequest('POST', url, THETA_USER, 
                THETA_PASS, true);
            var postData = { "name": "camera.getLivePreview" };
            
            // make the request
            getRequest.request(function(data) {
                console.log(data);
            },function(errorCode) {
                console.log("Failure: " + errorCode);
            }, postData);
        }


    </script>
</head>

<body>
    <p> Testing the Ricoh Theta V API </p>
    <button onclick="getRicohInfo()">Fetch Ricoh Info</button>
    <button onclick="getRicohState()">Fetch Ricoh State</button>
    <button onclick="getRicohLivePreview()">Get Live Preview</button>
</body>
</html>
